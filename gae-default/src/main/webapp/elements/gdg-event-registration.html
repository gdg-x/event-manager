<link rel="import" href="../components/iron-ajax/iron-ajax.html">

<dom-module id="gdg-event-registration">
	<template>
		<style>
			input {
				background-color: #f5f5f5;
				border: none;
				color: #15c;
				font-family: arial,sans-serif;
				font-size: 21px;
				font-weight: bold;
				height: 42px;
				text-align: center;
				width: 298px;
				position: relative;
				top: 2px;
			}
		</style>
		<iron-ajax auto url="/api/participants"
				   handle-as="text" on-response="onShortened"></iron-ajax>
	</template>
	<script>
	(function() {
		Polymer({
			is: "gdg-event-registration",
			properties: {
				qrCode: {
					computed: "computeQrcode(shortUrl)"
				}
			},
			computeQrcode: function(shortUrl) {
				return "http://dushu.hu/chart?cht=qr&chs=300x300&chld=H|0&chl="
				 	+ encodeURIComponent(shortUrl);
			},
			shorten: function() {
				this.$.shorten.generateRequest();
			},
			onShortened: function(e, request) {
				this.shortUrl = request.xhr.responseText;
				console.log(request.xhr);
			},
			keypressAction: function(ev) {
				var code = ev.keyCode || ev.charCode;
				var key = ev.keyIdentifier;
				if (key === 'Enter' || code === 13) {
					this.shorten();
				}
			}
		});
	})();
	</script>
</dom-module>